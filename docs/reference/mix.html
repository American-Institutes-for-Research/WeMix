<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Survey Weighted Mixed-Effects Models — mix • WeMix</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Survey Weighted Mixed-Effects Models — mix"><meta property="og:description" content="Implements a survey weighted mixed-effects model using the provided formula."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">WeMix</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">4.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Introduction_to_Mixed_Effects_Models_With_WeMix.html">Introduction to Weighted Mixed-Effects Models With WeMix</a>
    </li>
    <li>
      <a href="../articles/Weighted_Linear_Mixed_Effects_Models.html">Weighted Linear Mixed-Effects Models</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/American-Institutes-for-Research/WeMix/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Survey Weighted Mixed-Effects Models</h1>
    <small class="dont-index">Source: <a href="https://github.com/American-Institutes-for-Research/WeMix/blob/HEAD/R/adaptiveQuad.R" class="external-link"><code>R/adaptiveQuad.R</code></a></small>
    <div class="hidden name"><code>mix.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Implements a survey weighted mixed-effects model using the provided formula.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mix</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">weights</span>,</span>
<span>  cWeights <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  center_group <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  center_grand <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_iteration <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  nQuad <span class="op">=</span> <span class="fl">13L</span>,</span>
<span>  run <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  acc0 <span class="op">=</span> <span class="fl">120</span>,</span>
<span>  keepAdapting <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  start <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fast <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  family <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>formula</dt>
<dd><p>a formula object in the style of <code>lme4</code> that creates the model.</p></dd>


<dt>data</dt>
<dd><p>a data frame containing the raw data for the model.</p></dd>


<dt>weights</dt>
<dd><p>a character vector of names of weight variables found in the data frame starts with units (level 1) and increasing (larger groups).</p></dd>


<dt>cWeights</dt>
<dd><p>logical, set to <code>TRUE</code> to use conditional weights. Otherwise, <code>mix</code> expects unconditional weights.</p></dd>


<dt>center_group</dt>
<dd><p>a list where the name of each element is the name of the aggregation level, and the element is a formula of
variable names to be group mean centered; for example to group mean center gender and age within the group student:
 <code>list("student"= ~gender+age)</code>, default value of NULL does not perform any group mean centering.</p></dd>


<dt>center_grand</dt>
<dd><p>a formula of variable names  to be grand mean centered, for example to center the variable education by overall mean of 
education: <code>~education</code>. Default is NULL which does no centering.</p></dd>


<dt>max_iteration</dt>
<dd><p>a optional integer, for non-linear models fit by adaptive quadrature which limits number of iterations allowed
before quitting. Defaults  to 10. This is used because if the likelihood surface is flat, 
models may run for a very  long time without converging.</p></dd>


<dt>nQuad</dt>
<dd><p>an optional integer  number of quadrature points to evaluate models solved by adaptive quadrature.
Only non-linear models are evaluated with adaptive quadrature. See notes for additional guidelines.</p></dd>


<dt>run</dt>
<dd><p>logical; <code>TRUE</code> runs the model while <code>FALSE</code> provides partial output for debugging or testing. Only applies to non-linear
models evaluated by adaptive quadrature.</p></dd>


<dt>verbose</dt>
<dd><p>logical, default <code>FALSE</code>; set to <code>TRUE</code> to print results of intermediate steps of adaptive quadrature. Only applies to non-linear models.</p></dd>


<dt>acc0</dt>
<dd><p>deprecated; ignored.</p></dd>


<dt>keepAdapting</dt>
<dd><p>logical, set to <code>TRUE</code> when the adaptive quadrature should adapt after every Newton step. Defaults to <code>FALSE</code>. 
<code>FALSE</code> should be used for faster (but less accurate) results. Only applies to non-linear models.</p></dd>


<dt>start</dt>
<dd><p>optional numeric vector representing the point at which the model should start optimization; takes the shape of c(coef, vars) 
from results (see help).</p></dd>


<dt>fast</dt>
<dd><p>logical; deprecated</p></dd>


<dt>family</dt>
<dd><p>the family; optionally used to specify generalized linear mixed models. Currently only <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial()</a></code> 
and <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson()</a></code> are supported.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>object of class <code>WeMixResults</code>. 
This is a list with elements:</p>
<dl><dt>lnlf</dt>
<dd><p>function, the likelihood function.</p></dd>
 
<dt>lnl</dt>
<dd><p>numeric, the log-likelihood of the model.</p></dd>

<dt>coef</dt>
<dd><p>numeric vector, the estimated coefficients of the model.</p></dd>

<dt>ranefs</dt>
<dd><p>the group-level random effects.</p></dd>

<dt>SE</dt>
<dd><p>the cluste robust (CR-0) standard errors of the fixed effects.</p></dd>

<dt>vars</dt>
<dd><p>numeric vector, the random effect variances.</p></dd>

<dt>theta</dt>
<dd><p>the theta vector.</p></dd>

<dt>call</dt>
<dd><p>the original call used.</p></dd>

<dt>levels</dt>
<dd><p>integer, the number of levels in the model.</p></dd>

<dt>ICC</dt>
<dd><p>numeric, the intraclass correlation coefficient.</p></dd>

<dt>CMODE</dt>
<dd><p>the conditional mean of the random effects.</p></dd>

<dt>invHessian</dt>
<dd><p>inverse of the second derivative of the likelihood function.</p></dd>

<dt>ICC</dt>
<dd><p>the interclass correlation.</p></dd>

<dt>is_adaptive</dt>
<dd><p>logical, indicates if adaptive quadrature was used for estimation.</p></dd>

<dt>sigma</dt>
<dd><p>the sigma value.</p></dd>

<dt>ngroups</dt>
<dd><p>the number of observations in each group.</p></dd>

<dt>varDF</dt>
<dd><p>the variance data frame in the format of the variance data frame returned by lme4.</p></dd>

<dt>varVC</dt>
<dd><p>the variance-covariance matrix of the random effects.</p></dd>

<dt>cov_mat</dt>
<dd><p>the variance-covariance matrix of the fixed effects.</p></dd>

<dt>var_theta</dt>
<dd><p>the variance covariance matrix of the theta terms.</p></dd>

<dt>wgtStats</dt>
<dd><p>statistics regarding weights, by level.</p></dd>

<dt>ranefMat</dt>
<dd><p>list of matrixes; each list element is a matrix of random effects by level with IDs in the rows and random effects in the columns.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>Linear models are solved using a modification of the analytic solution developed by Bates and Pinheiro (1998).
Non-linear models are solved using adaptive quadrature following the methods in STATA's GLAMMM (Rabe-Hesketh &amp; Skrondal, 2006) 
and Pineiro and Chao (2006). The posterior modes used in adaptive quadrature are determined following the method in lme4pureR (Walker &amp; Bates, 2015).
For additional details, see the vignettes <em>Weighted Mixed Models: Adaptive Quadrature</em> and  <em>Weighted Mixed Models: Analytical Solution</em> 
which provide extensive examples as well as a description of the mathematical basis of the estimation procedure and comparisons to model 
specifications in other common software. 
Notes:</p><ul><li><p>Standard errors of random effect variances are robust; see vignette for details.</p></li>
<li><p>To see the function that is maximized in the estimation of this model, see the section on "Model Fitting" in the
 <em>Introduction to Mixed Effect Models With WeMix</em> vignette.</p></li>
<li><p>When all weights above the individual level are 1, this is similar to a <code>lmer</code> and you should use <code>lme4</code> 
because it is much faster.</p></li>
<li><p>If  starting coefficients are not provided they are estimated using <code>lme4</code>.</p></li>
<li><p>For non-linear models, when the variance of a random effect is very low (&lt;.1), WeMix doesn't estimate it, because very 
low variances create problems with  numerical evaluation. In these cases, consider estimating without that random effect.</p></li>
<li><p>The model is estimated by maximum likelihood estimation.</p></li>
<li><p>Non-linear models may have up to 3 nested levels.</p></li>
<li><p>To choose the number of quadrature points for non-linear model evaluation, a balance is needed between accuracy and
speed; estimation time increases quadratically with the number of points chosen. In addition, an odd number of points is 
traditionally used. We recommend starting at 13 and increasing or decreasing as needed.</p></li>
</ul></div>
    <div id="author">
    <h2>Author</h2>
    <p>Paul Bailey, Blue Webb, Claire Kelley, and Trang Nguyen</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sleepstudy</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ss1</span> <span class="op">&lt;-</span> <span class="va">sleepstudy</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create weights</span></span></span>
<span class="r-in"><span><span class="va">ss1</span><span class="op">$</span><span class="va">W1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ss1</span><span class="op">$</span><span class="va">Subject</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">308</span>, <span class="fl">309</span>, <span class="fl">310</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ss1</span><span class="op">$</span><span class="va">W2</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run random-intercept 2-level model </span></span></span>
<span class="r-in"><span><span class="va">two_level</span> <span class="op">&lt;-</span> <span class="fu">mix</span><span class="op">(</span><span class="va">Reaction</span> <span class="op">~</span> <span class="va">Days</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">Subject</span><span class="op">)</span>, data<span class="op">=</span><span class="va">ss1</span>, weights<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"W1"</span>, <span class="st">"W2"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Run random-intercept 2-level model with group-mean centering</span></span></span>
<span class="r-in"><span><span class="va">grp_centered</span> <span class="op">&lt;-</span> <span class="fu">mix</span><span class="op">(</span><span class="va">Reaction</span> <span class="op">~</span> <span class="va">Days</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">Subject</span><span class="op">)</span>, data<span class="op">=</span><span class="va">ss1</span>,</span></span>
<span class="r-in"><span>                    weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"W1"</span>, <span class="st">"W2"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    center_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Subject"</span> <span class="op">=</span> <span class="op">~</span><span class="va">Days</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Run three level model with random slope and intercept. </span></span></span>
<span class="r-in"><span><span class="co">#add group variables for 3 level model </span></span></span>
<span class="r-in"><span><span class="va">ss1</span><span class="op">$</span><span class="va">Group</span> <span class="op">&lt;-</span> <span class="fl">3</span></span></span>
<span class="r-in"><span><span class="va">ss1</span><span class="op">$</span><span class="va">Group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">ss1</span><span class="op">$</span><span class="va">Subject</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">10</span> <span class="op">&lt;</span> <span class="fl">7</span>, <span class="fl">2</span>, <span class="va">ss1</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ss1</span><span class="op">$</span><span class="va">Group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">ss1</span><span class="op">$</span><span class="va">Subject</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">10</span> <span class="op">&lt;</span> <span class="fl">4</span>, <span class="fl">1</span>, <span class="va">ss1</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># level-3 weights</span></span></span>
<span class="r-in"><span><span class="va">ss1</span><span class="op">$</span><span class="va">W3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ss1</span><span class="op">$</span><span class="va">Group</span> <span class="op">==</span> <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">three_level</span> <span class="op">&lt;-</span> <span class="fu">mix</span><span class="op">(</span><span class="va">Reaction</span> <span class="op">~</span> <span class="va">Days</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">Subject</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">Days</span><span class="op">|</span><span class="va">Group</span><span class="op">)</span>, data<span class="op">=</span><span class="va">ss1</span>, </span></span>
<span class="r-in"><span>                   weights<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"W1"</span>, <span class="st">"W2"</span>, <span class="st">"W3"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Conditional Weights</span></span></span>
<span class="r-in"><span><span class="co"># use vignette example</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.air.org/project/nces-data-r-project-edsurvey" class="external-link">EdSurvey</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#read in data </span></span></span>
<span class="r-in"><span><span class="fu">downloadPISA</span><span class="op">(</span><span class="st">"~/"</span>, year<span class="op">=</span><span class="fl">2012</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cntl</span> <span class="op">&lt;-</span> <span class="fu">readPISA</span><span class="op">(</span><span class="st">"~/PISA/2012"</span>, countries<span class="op">=</span><span class="st">"USA"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/getData.html" class="external-link">getData</a></span><span class="op">(</span><span class="va">cntl</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"schoolid"</span>,<span class="st">"pv1math"</span>,<span class="st">"st29q03"</span>,<span class="st">"sc14q02"</span>,<span class="st">"st04q01"</span>,</span></span>
<span class="r-in"><span>                       <span class="st">"escs"</span>,<span class="st">"w_fschwt"</span>,<span class="st">"w_fstuwt"</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                omittedLevels<span class="op">=</span><span class="cn">FALSE</span>, addAttributes<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Remove NA and omitted Levels</span></span></span>
<span class="r-in"><span><span class="va">om</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Invalid"</span>, <span class="st">"N/A"</span>, <span class="st">"Missing"</span>, <span class="st">"Miss"</span>, <span class="cn">NA</span>, <span class="st">"(Missing)"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="op">!</span><span class="va">data</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">om</span>,<span class="op">]</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#relevel factors for model </span></span></span>
<span class="r-in"><span><span class="va">data</span><span class="op">$</span><span class="va">st29q03</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html" class="external-link">relevel</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">st29q03</span>, ref<span class="op">=</span><span class="st">"Strongly agree"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data</span><span class="op">$</span><span class="va">sc14q02</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html" class="external-link">relevel</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">sc14q02</span>, ref<span class="op">=</span><span class="st">"Not at all"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># run with unconditional weights</span></span></span>
<span class="r-in"><span><span class="va">m1u</span> <span class="op">&lt;-</span> <span class="fu">mix</span><span class="op">(</span><span class="va">pv1math</span> <span class="op">~</span> <span class="va">st29q03</span> <span class="op">+</span> <span class="va">sc14q02</span> <span class="op">+</span><span class="va">st04q01</span><span class="op">+</span><span class="va">escs</span><span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">schoolid</span><span class="op">)</span>, data<span class="op">=</span><span class="va">data</span>, </span></span>
<span class="r-in"><span>           weights<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"w_fstuwt"</span>, <span class="st">"w_fschwt"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m1u</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># conditional weights</span></span></span>
<span class="r-in"><span><span class="va">data</span><span class="op">$</span><span class="va">pwt2</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">w_fschwt</span></span></span>
<span class="r-in"><span><span class="va">data</span><span class="op">$</span><span class="va">pwt1</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">w_fstuwt</span> <span class="op">/</span> <span class="va">data</span><span class="op">$</span><span class="va">w_fschwt</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># run with conditional weights</span></span></span>
<span class="r-in"><span><span class="va">m1c</span> <span class="op">&lt;-</span> <span class="fu">mix</span><span class="op">(</span><span class="va">pv1math</span> <span class="op">~</span> <span class="va">st29q03</span> <span class="op">+</span> <span class="va">sc14q02</span> <span class="op">+</span><span class="va">st04q01</span><span class="op">+</span><span class="va">escs</span><span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">schoolid</span><span class="op">)</span>, data<span class="op">=</span><span class="va">data</span>, </span></span>
<span class="r-in"><span>            weights<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pwt1"</span>, <span class="st">"pwt2"</span><span class="op">)</span>, cWeights<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m1c</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># the results are, up to rounding, the same in m1u and m1c, only the calls are different</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Paul Bailey, Blue Webb, Claire Kelley, Trang Nguyen, Huade Huo.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

